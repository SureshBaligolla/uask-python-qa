{"name": "test_simple_chat_responses[desktop-testdata3]", "status": "failed", "statusDetails": {"message": "AssertionError: Similarity too low (0.161) for Arabic prompt: من أنت؟\nassert 0.161 >= 0.6\n +  where 0.6 = config.SIMILARITY_THRESHOLD_AR", "trace": "driver = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"dfb52c00b6c4b7e238b8dc790b5bef9e\")>\nlogger = <Logger uask (INFO)>, run_id = '20251104T131135-943cab'\ntestdata = {'expected_ar': 'أنا GovGPT، مساعد ذكي مصمم لتقديم إجابات دقيقة وواضحة تحترم القيم الإسلامية والثقافة الإماراتية، خاصة في ما يتعلق بالعمليات الحكومية أو أي استفسارات عامة أخرى.', 'prompt_ar': 'من أنت؟'}\n\n    @pytest.mark.parametrize(\"testdata\", json.load(open(\"test_data/test-data.json\", encoding=\"utf-8\")))\n    def test_simple_chat_responses(driver, logger, run_id, testdata):\n        \"\"\"\n        Validate chatbot responses semantically using OpenAI embeddings.\n        Also validate multilingual behavior: English (LTR) and Arabic (RTL).\n        \"\"\"\n        login_page = LoginPage(driver)\n        chat_page = ChatPage(driver, logger=logger)\n    \n        # Step 1: Login\n        assert login_page.is_loaded(), \"Login page did not load properly\"\n        login_page.login()\n        assert chat_page.is_ready(), \"Chatbox not ready after login\"\n    \n        # ENGLISH\n        prompt_en = testdata.get(\"prompt_en\")\n        expected_en = testdata.get(\"expected_en\")\n    \n        if prompt_en and expected_en:\n            logger.info(sanitize_text(\"Sending English prompt\"), extra={\"step\": \"test_simple_chat_responses\", \"prompt\": prompt_en[:120]})\n            chat_page.send_message(prompt_en)\n            actual_en = chat_page.wait_for_ai_response(timeout=30)\n    \n            # Retry once if incomplete\n            if not actual_en or len(actual_en.strip()) < 50:\n                logger.warning(\"English response seems incomplete, retrying\", extra={\"step\": \"test_simple_chat_responses\"})\n                time.sleep(1)\n                extra = chat_page.wait_for_ai_response(timeout=10)\n                if extra and len(extra) > len(actual_en or \"\"):\n                    actual_en = extra\n    \n            assert actual_en and actual_en.strip(), \"No AI response captured for English prompt\"\n    \n            similarity_en = openai_validator.calculate_similarity(expected_en, actual_en)\n    \n            logger.info(sanitize_text(f\"English similarity: {similarity_en}\"), extra={\"step\": \"test_simple_chat_responses\", \"similarity\": similarity_en})\n            with allure.step(\"Attach English response details\"):\n                allure.attach(sanitize_text(prompt_en), name=\"English Prompt\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(sanitize_text(expected_en), name=\"Expected English Response\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(sanitize_text(actual_en), name=\"Actual English Response\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(str(round(similarity_en, 3)), name=\"English Similarity Score\", attachment_type=allure.attachment_type.TEXT)\n                if similarity_en < config.SIMILARITY_THRESHOLD_EN:\n                    try:\n                        allure.attach(driver.get_screenshot_as_png(), name=\"English Screenshot\", attachment_type=allure.attachment_type.PNG)\n                    except Exception:\n                        pass\n    \n            assert similarity_en >= config.SIMILARITY_THRESHOLD_EN, f\"Similarity too low ({similarity_en:.3f}) for prompt: {prompt_en}\"\n    \n        # ARABIC\n        prompt_ar = testdata.get(\"prompt_ar\")\n        expected_ar = testdata.get(\"expected_ar\")\n    \n        if prompt_ar and expected_ar:\n            logger.info(sanitize_text(\"Sending Arabic prompt\"), extra={\"step\": \"test_simple_chat_responses\", \"prompt_ar\": prompt_ar[:120]})\n            chat_page.send_message(prompt_ar)\n            actual_ar = chat_page.wait_for_ai_response(timeout=35)\n    \n            if not actual_ar or len(actual_ar.strip()) < 50:\n                logger.warning(\"Arabic response seems incomplete, retrying\", extra={\"step\": \"test_simple_chat_responses\"})\n                time.sleep(1)\n                extra = chat_page.wait_for_ai_response(timeout=12)\n                if extra and len(extra) > len(actual_ar or \"\"):\n                    actual_ar = extra\n    \n            assert actual_ar and actual_ar.strip(), \"No AI response captured for Arabic prompt\"\n    \n            similarity_ar = openai_validator.calculate_similarity(expected_ar, actual_ar)\n    \n            logger.info(sanitize_text(f\"Arabic similarity: {similarity_ar}\"), extra={\"step\": \"test_simple_chat_responses\", \"similarity\": similarity_ar})\n            with allure.step(\"Attach Arabic response details\"):\n                allure.attach(sanitize_text(prompt_ar), name=\"Arabic Prompt\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(sanitize_text(expected_ar), name=\"Expected Arabic Response\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(sanitize_text(actual_ar), name=\"Actual Arabic Response\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(str(round(similarity_ar, 3)), name=\"Arabic Similarity Score\", attachment_type=allure.attachment_type.TEXT)\n                if similarity_ar < config.SIMILARITY_THRESHOLD_AR:\n                    try:\n                        allure.attach(driver.get_screenshot_as_png(), name=\"Arabic Screenshot\", attachment_type=allure.attachment_type.PNG)\n                    except Exception:\n                        pass\n    \n>           assert similarity_ar >= config.SIMILARITY_THRESHOLD_AR, f\"Similarity too low ({similarity_ar:.3f}) for Arabic prompt: {prompt_ar}\"\nE           AssertionError: Similarity too low (0.161) for Arabic prompt: من أنت؟\nE           assert 0.161 >= 0.6\nE            +  where 0.6 = config.SIMILARITY_THRESHOLD_AR\n\ntests/test_chat_validation.py:93: AssertionError"}, "description": "\n    Validate chatbot responses semantically using OpenAI embeddings.\n    Also validate multilingual behavior: English (LTR) and Arabic (RTL).\n    ", "steps": [{"name": "Attach Arabic response details", "status": "passed", "attachments": [{"name": "Arabic Prompt", "source": "cc826c2d-cf1b-4278-a82d-11efbcb1b7fd-attachment.txt", "type": "text/plain"}, {"name": "Expected Arabic Response", "source": "21e8c463-4eb7-40f9-a982-bbdbb8f09e63-attachment.txt", "type": "text/plain"}, {"name": "Actual Arabic Response", "source": "5b2c0b8c-fe8a-4ab2-8dc3-6153eeea81d3-attachment.txt", "type": "text/plain"}, {"name": "Arabic Similarity Score", "source": "259f335a-13b5-4768-a191-ec07842adb64-attachment.txt", "type": "text/plain"}, {"name": "Arabic Screenshot", "source": "553d5294-fe74-4bc3-bc11-2844bffe9b80-attachment.png", "type": "image/png"}], "start": 1762242318850, "stop": 1762242319019}], "attachments": [{"name": "screenshot", "source": "8f37df0a-095e-4c3b-b455-ba0958b36de9-attachment.png", "type": "image/png"}, {"name": "run-log", "source": "416c8a2d-1970-497c-b64e-05dff59f5fb4-attachment.txt", "type": "text/plain"}, {"name": "log", "source": "6fbaf902-476f-4889-bbca-84a86e46ef2e-attachment.txt", "type": "text/plain"}, {"name": "stdout", "source": "7dc8ccb6-d2b6-43d8-b054-d7995727c54c-attachment.txt", "type": "text/plain"}, {"name": "stderr", "source": "ad793ef2-9ece-4ee5-8535-9298e1407f21-attachment.txt", "type": "text/plain"}], "parameters": [{"name": "driver", "value": "'desktop'"}, {"name": "testdata", "value": "{'prompt_ar': 'من أنت؟', 'expected_ar': 'أنا GovGPT، مساعد ذكي مصمم لتقديم إجابات دقيقة وواضحة تحترم القيم الإسلامية والثقافة الإماراتية، خاصة في ما يتعلق بالعمليات الحكومية أو أي استفسارات عامة أخرى.'}"}], "start": 1762242247319, "stop": 1762242319021, "uuid": "4050ce09-af87-4b0a-82f7-7f977d4b851c", "historyId": "ac09bba9dc5b9df980ec08487e827929", "testCaseId": "1eafbf63f4cfee4d4afb3e39a8b20a39", "fullName": "tests.test_chat_validation#test_simple_chat_responses", "labels": [{"name": "parentSuite", "value": "tests"}, {"name": "suite", "value": "test_chat_validation"}, {"name": "host", "value": "Hemanth.local"}, {"name": "thread", "value": "24100-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "tests.test_chat_validation"}], "titlePath": ["tests", "test_chat_validation.py"]}