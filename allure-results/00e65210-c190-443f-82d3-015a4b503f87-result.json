{"name": "test_simple_chat_responses[desktop-testdata0]", "status": "failed", "statusDetails": {"message": "AssertionError: Similarity too low (0.109) for prompt: How to get new emirates id\nassert 0.109 >= 0.6\n +  where 0.6 = config.SIMILARITY_THRESHOLD_EN", "trace": "driver = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"720f1954f8b909df78afb941827e7cad\")>\nlogger = <Logger uask (INFO)>, run_id = '20251104T120347-a446c7'\ntestdata = {'expected_en': 'Obtaining a new Emirates ID is a mandatory process for all UAE citizens and residents. The Emirates I...ore. Below is a clear, step-by-step guide to help you through the process:', 'prompt_en': 'How to get new emirates id'}\n\n    @pytest.mark.parametrize(\"testdata\", json.load(open(\"test_data/test-data.json\", encoding=\"utf-8\")))\n    def test_simple_chat_responses(driver, logger, run_id, testdata):\n        \"\"\"\n        Validate chatbot responses semantically using OpenAI embeddings.\n        Also validate multilingual behavior: English (LTR) and Arabic (RTL).\n        \"\"\"\n        login_page = LoginPage(driver)\n        chat_page = ChatPage(driver, logger=logger)\n    \n        # Step 1: Login\n        assert login_page.is_loaded(), \"Login page did not load properly\"\n        login_page.login()\n        assert chat_page.is_ready(), \"Chatbox not ready after login\"\n    \n        # ENGLISH\n        prompt_en = testdata.get(\"prompt_en\")\n        expected_en = testdata.get(\"expected_en\")\n    \n        if prompt_en and expected_en:\n            logger.info(sanitize_text(\"Sending English prompt\"), extra={\"step\": \"test_simple_chat_responses\", \"prompt\": prompt_en[:120]})\n            chat_page.send_message(prompt_en)\n            actual_en = chat_page.wait_for_ai_response(timeout=30)\n    \n            # Retry once if incomplete\n            if not actual_en or len(actual_en.strip()) < 50:\n                logger.warning(\"English response seems incomplete, retrying\", extra={\"step\": \"test_simple_chat_responses\"})\n                time.sleep(1)\n                extra = chat_page.wait_for_ai_response(timeout=10)\n                if extra and len(extra) > len(actual_en or \"\"):\n                    actual_en = extra\n    \n            assert actual_en and actual_en.strip(), \"No AI response captured for English prompt\"\n    \n            similarity_en = openai_validator.calculate_similarity(expected_en, actual_en)\n    \n            logger.info(sanitize_text(f\"English similarity: {similarity_en}\"), extra={\"step\": \"test_simple_chat_responses\", \"similarity\": similarity_en})\n            with allure.step(\"Attach English response details\"):\n                allure.attach(sanitize_text(prompt_en), name=\"English Prompt\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(sanitize_text(expected_en), name=\"Expected English Response\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(sanitize_text(actual_en), name=\"Actual English Response\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(str(round(similarity_en, 3)), name=\"English Similarity Score\", attachment_type=allure.attachment_type.TEXT)\n                if similarity_en < config.SIMILARITY_THRESHOLD_EN:\n                    try:\n                        allure.attach(driver.get_screenshot_as_png(), name=\"English Screenshot\", attachment_type=allure.attachment_type.PNG)\n                    except Exception:\n                        pass\n    \n>           assert similarity_en >= config.SIMILARITY_THRESHOLD_EN, f\"Similarity too low ({similarity_en:.3f}) for prompt: {prompt_en}\"\nE           AssertionError: Similarity too low (0.109) for prompt: How to get new emirates id\nE           assert 0.109 >= 0.6\nE            +  where 0.6 = config.SIMILARITY_THRESHOLD_EN\n\ntests/test_chat_validation.py:59: AssertionError"}, "description": "\n    Validate chatbot responses semantically using OpenAI embeddings.\n    Also validate multilingual behavior: English (LTR) and Arabic (RTL).\n    ", "steps": [{"name": "Attach English response details", "status": "passed", "attachments": [{"name": "English Prompt", "source": "d3769118-1876-4888-bf50-147395f1b880-attachment.txt", "type": "text/plain"}, {"name": "Expected English Response", "source": "60423480-b4cf-4938-9c88-e49125e562b5-attachment.txt", "type": "text/plain"}, {"name": "Actual English Response", "source": "d0173c6d-92aa-4057-9394-21465554200a-attachment.txt", "type": "text/plain"}, {"name": "English Similarity Score", "source": "3f216e9b-1d71-4098-8c6d-ddd2ea231454-attachment.txt", "type": "text/plain"}, {"name": "English Screenshot", "source": "76077cdf-6c33-4724-91f9-7f6f381ad714-attachment.png", "type": "image/png"}], "start": 1762238047585, "stop": 1762238047744}], "attachments": [{"name": "screenshot", "source": "ac0bc261-d5e1-4579-bfa1-1614dec28389-attachment.png", "type": "image/png"}, {"name": "run-log", "source": "8b01ca7b-6178-41fa-9a2f-b89f1a7e4f8d-attachment.txt", "type": "text/plain"}, {"name": "log", "source": "7a9dd8e3-6e4a-46ef-bf5d-d19300d40533-attachment.txt", "type": "text/plain"}, {"name": "stdout", "source": "efff0e24-edb8-4342-a391-cdc1be2c3d4d-attachment.txt", "type": "text/plain"}, {"name": "stderr", "source": "ac7def09-68d8-46d5-8fed-336ff277d692-attachment.txt", "type": "text/plain"}], "parameters": [{"name": "driver", "value": "'desktop'"}, {"name": "testdata", "value": "{'prompt_en': 'How to get new emirates id', 'expected_en': 'Obtaining a new Emirates ID is a mandatory process for all UAE citizens and residents. The Emirates ID is issued by the Federal Authority for Identity, Citizenship, Customs & Port Security (ICP) and is essential for accessing government services, banking, healthcare, and more. Below is a clear, step-by-step guide to help you through the process:'}"}], "start": 1762238032501, "stop": 1762238047745, "uuid": "254bf6e2-017b-48fb-ab0b-4f55827ee6eb", "historyId": "1b98be9746de8446fee64b5219094906", "testCaseId": "1eafbf63f4cfee4d4afb3e39a8b20a39", "fullName": "tests.test_chat_validation#test_simple_chat_responses", "labels": [{"name": "parentSuite", "value": "tests"}, {"name": "suite", "value": "test_chat_validation"}, {"name": "host", "value": "Hemanth.local"}, {"name": "thread", "value": "13108-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "tests.test_chat_validation"}], "titlePath": ["tests", "test_chat_validation.py"]}