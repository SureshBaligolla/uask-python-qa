{"uid":"9e4793bf08eee2e4","name":"test_simple_chat_responses[desktop-testdata13]","fullName":"tests.test_chat_validation#test_simple_chat_responses","historyId":"4ca6f9ede0405446db1acf79f92bf77f","time":{"start":1761913282691,"stop":1761913352042,"duration":69351},"description":"\n    Validate chatbot responses semantically using OpenAI embeddings.\n    Also validate multilingual behavior: English (LTR) and Arabic (RTL).\n    ","descriptionHtml":"<pre><code>Validate chatbot responses semantically using OpenAI embeddings.\nAlso validate multilingual behavior: English (LTR) and Arabic (RTL).\n</code></pre>\n","status":"failed","statusMessage":"AssertionError: ❌ Similarity too low (0.260) for Arabic prompt: اختبر الاتجاه\nassert 0.26 >= 0.33\n +  where 0.33 = config.SIMILARITY_THRESHOLD_AR","statusTrace":"driver = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"d4751549417a3ca35f5737d822535e55\")>\ntestdata = {'expected_ar': 'واجهة المستخدم باللغة العربية يجب أن تكون من اليمين إلى اليسار (RTL).', 'prompt_ar': 'اختبر الاتجاه'}\n\n    @pytest.mark.parametrize(\"testdata\", json.load(open(\"test_data/test-data.json\", encoding=\"utf-8\")))\n    def test_simple_chat_responses(driver, testdata):\n        \"\"\"\n        Validate chatbot responses semantically using OpenAI embeddings.\n        Also validate multilingual behavior: English (LTR) and Arabic (RTL).\n        \"\"\"\n        login_page = LoginPage(driver)\n        chat_page = ChatPage(driver)\n    \n        # Step 1: Login\n        assert login_page.is_loaded(), \"❌ Login page did not load properly\"\n        login_page.login()\n        assert chat_page.is_ready(), \"❌ Chatbox not ready after login\"\n    \n        # ============================================================\n        # \uD83C\uDF0D ENGLISH TEST\n        # ============================================================\n        prompt_en = testdata.get(\"prompt_en\")\n        expected_en = testdata.get(\"expected_en\")\n    \n        if prompt_en and expected_en:\n            chat_page.send_message(prompt_en)\n            actual_en = chat_page.wait_for_ai_response(timeout=30)\n    \n            # Retry once if response looks truncated or empty\n            if not actual_en or len(actual_en.strip()) < 50:\n                print(\"⚠️ English response seems incomplete, retrying...\")\n                time.sleep(1)\n                extra = chat_page.wait_for_ai_response(timeout=10)\n                if extra and len(extra) > len(actual_en or \"\"):\n                    actual_en = extra\n    \n            # Fail fast if empty\n            assert actual_en and actual_en.strip(), \"❌ No AI response captured for English prompt\"\n    \n            similarity_en = openai_validator.calculate_similarity(expected_en, actual_en)\n    \n            print(f\"\\n\uD83C\uDF0D English Prompt: {prompt_en}\")\n            print(f\"Expected: {expected_en}\")\n            print(f\"Actual ({len(actual_en)} chars): {actual_en}\")\n            print(f\"\uD83D\uDD0D Similarity Score: {similarity_en}\")\n    \n            # ✅ Attach English results to Allure report\n            with allure.step(\"Attach English response details\"):\n                allure.attach(prompt_en, name=\"English Prompt\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(expected_en, name=\"Expected English Response\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(actual_en, name=\"Actual English Response\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(str(round(similarity_en, 3)), name=\"English Similarity Score\", attachment_type=allure.attachment_type.TEXT)\n    \n                # Screenshot on low similarity\n                if similarity_en < config.SIMILARITY_THRESHOLD_EN:\n                    try:\n                        allure.attach(driver.get_screenshot_as_png(), name=\"English Screenshot\", attachment_type=allure.attachment_type.PNG)\n                    except Exception:\n                        pass\n    \n            # ✅ Semantic validation\n            assert similarity_en >= config.SIMILARITY_THRESHOLD_EN, (\n                f\"❌ Similarity too low ({similarity_en:.3f}) for prompt: {prompt_en}\"\n            )\n            print(f\"✅ English validated successfully with similarity {similarity_en:.3f}\")\n    \n        # ============================================================\n        # \uD83D\uDD4C ARABIC TEST\n        # ============================================================\n        prompt_ar = testdata.get(\"prompt_ar\")\n        expected_ar = testdata.get(\"expected_ar\")\n    \n        print(f\"DEBUG Arabic Data → prompt_ar={prompt_ar}, expected_ar={expected_ar}\")\n    \n        if prompt_ar and expected_ar:\n            chat_page.send_message(prompt_ar)\n            actual_ar = chat_page.wait_for_ai_response(timeout=35)\n    \n            # Retry once if response looks truncated or empty\n            if not actual_ar or len(actual_ar.strip()) < 50:\n                print(\"⚠️ Arabic response seems incomplete, retrying...\")\n                time.sleep(1)\n                extra = chat_page.wait_for_ai_response(timeout=12)\n                if extra and len(extra) > len(actual_ar or \"\"):\n                    actual_ar = extra\n    \n            # Fail fast if still empty\n            assert actual_ar and actual_ar.strip(), \"❌ No AI response captured for Arabic prompt\"\n    \n            similarity_ar = openai_validator.calculate_similarity(expected_ar, actual_ar)\n    \n            print(f\"\\n\uD83D\uDD4C Arabic Prompt: {prompt_ar}\")\n            print(f\"Expected: {expected_ar}\")\n            print(f\"Actual ({len(actual_ar)} chars): {actual_ar}\")\n            print(f\"\uD83D\uDD0D Similarity Score: {similarity_ar}\")\n    \n            # ✅ Attach Arabic results to Allure report\n            with allure.step(\"Attach Arabic response details\"):\n                allure.attach(prompt_ar, name=\"Arabic Prompt\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(expected_ar, name=\"Expected Arabic Response\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(actual_ar, name=\"Actual Arabic Response\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(str(round(similarity_ar, 3)), name=\"Arabic Similarity Score\", attachment_type=allure.attachment_type.TEXT)\n    \n                # Screenshot on low similarity\n                if similarity_ar < config.SIMILARITY_THRESHOLD_AR:\n                    try:\n                        allure.attach(driver.get_screenshot_as_png(), name=\"Arabic Screenshot\", attachment_type=allure.attachment_type.PNG)\n                    except Exception:\n                        pass\n    \n            # ✅ Semantic validation\n>           assert similarity_ar >= config.SIMILARITY_THRESHOLD_AR, (\n                f\"❌ Similarity too low ({similarity_ar:.3f}) for Arabic prompt: {prompt_ar}\"\n            )\nE           AssertionError: ❌ Similarity too low (0.260) for Arabic prompt: اختبر الاتجاه\nE           assert 0.26 >= 0.33\nE            +  where 0.33 = config.SIMILARITY_THRESHOLD_AR\n\ntests/test_chat_validation.py:304: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"driver","time":{"start":1761912391632,"stop":1761912394550,"duration":2918},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"hasContent":false,"attachmentStep":false,"shouldDisplayMessage":false,"attachmentsCount":0}],"testStage":{"description":"\n    Validate chatbot responses semantically using OpenAI embeddings.\n    Also validate multilingual behavior: English (LTR) and Arabic (RTL).\n    ","status":"failed","statusMessage":"AssertionError: ❌ Similarity too low (0.260) for Arabic prompt: اختبر الاتجاه\nassert 0.26 >= 0.33\n +  where 0.33 = config.SIMILARITY_THRESHOLD_AR","statusTrace":"driver = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"d4751549417a3ca35f5737d822535e55\")>\ntestdata = {'expected_ar': 'واجهة المستخدم باللغة العربية يجب أن تكون من اليمين إلى اليسار (RTL).', 'prompt_ar': 'اختبر الاتجاه'}\n\n    @pytest.mark.parametrize(\"testdata\", json.load(open(\"test_data/test-data.json\", encoding=\"utf-8\")))\n    def test_simple_chat_responses(driver, testdata):\n        \"\"\"\n        Validate chatbot responses semantically using OpenAI embeddings.\n        Also validate multilingual behavior: English (LTR) and Arabic (RTL).\n        \"\"\"\n        login_page = LoginPage(driver)\n        chat_page = ChatPage(driver)\n    \n        # Step 1: Login\n        assert login_page.is_loaded(), \"❌ Login page did not load properly\"\n        login_page.login()\n        assert chat_page.is_ready(), \"❌ Chatbox not ready after login\"\n    \n        # ============================================================\n        # \uD83C\uDF0D ENGLISH TEST\n        # ============================================================\n        prompt_en = testdata.get(\"prompt_en\")\n        expected_en = testdata.get(\"expected_en\")\n    \n        if prompt_en and expected_en:\n            chat_page.send_message(prompt_en)\n            actual_en = chat_page.wait_for_ai_response(timeout=30)\n    \n            # Retry once if response looks truncated or empty\n            if not actual_en or len(actual_en.strip()) < 50:\n                print(\"⚠️ English response seems incomplete, retrying...\")\n                time.sleep(1)\n                extra = chat_page.wait_for_ai_response(timeout=10)\n                if extra and len(extra) > len(actual_en or \"\"):\n                    actual_en = extra\n    \n            # Fail fast if empty\n            assert actual_en and actual_en.strip(), \"❌ No AI response captured for English prompt\"\n    \n            similarity_en = openai_validator.calculate_similarity(expected_en, actual_en)\n    \n            print(f\"\\n\uD83C\uDF0D English Prompt: {prompt_en}\")\n            print(f\"Expected: {expected_en}\")\n            print(f\"Actual ({len(actual_en)} chars): {actual_en}\")\n            print(f\"\uD83D\uDD0D Similarity Score: {similarity_en}\")\n    \n            # ✅ Attach English results to Allure report\n            with allure.step(\"Attach English response details\"):\n                allure.attach(prompt_en, name=\"English Prompt\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(expected_en, name=\"Expected English Response\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(actual_en, name=\"Actual English Response\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(str(round(similarity_en, 3)), name=\"English Similarity Score\", attachment_type=allure.attachment_type.TEXT)\n    \n                # Screenshot on low similarity\n                if similarity_en < config.SIMILARITY_THRESHOLD_EN:\n                    try:\n                        allure.attach(driver.get_screenshot_as_png(), name=\"English Screenshot\", attachment_type=allure.attachment_type.PNG)\n                    except Exception:\n                        pass\n    \n            # ✅ Semantic validation\n            assert similarity_en >= config.SIMILARITY_THRESHOLD_EN, (\n                f\"❌ Similarity too low ({similarity_en:.3f}) for prompt: {prompt_en}\"\n            )\n            print(f\"✅ English validated successfully with similarity {similarity_en:.3f}\")\n    \n        # ============================================================\n        # \uD83D\uDD4C ARABIC TEST\n        # ============================================================\n        prompt_ar = testdata.get(\"prompt_ar\")\n        expected_ar = testdata.get(\"expected_ar\")\n    \n        print(f\"DEBUG Arabic Data → prompt_ar={prompt_ar}, expected_ar={expected_ar}\")\n    \n        if prompt_ar and expected_ar:\n            chat_page.send_message(prompt_ar)\n            actual_ar = chat_page.wait_for_ai_response(timeout=35)\n    \n            # Retry once if response looks truncated or empty\n            if not actual_ar or len(actual_ar.strip()) < 50:\n                print(\"⚠️ Arabic response seems incomplete, retrying...\")\n                time.sleep(1)\n                extra = chat_page.wait_for_ai_response(timeout=12)\n                if extra and len(extra) > len(actual_ar or \"\"):\n                    actual_ar = extra\n    \n            # Fail fast if still empty\n            assert actual_ar and actual_ar.strip(), \"❌ No AI response captured for Arabic prompt\"\n    \n            similarity_ar = openai_validator.calculate_similarity(expected_ar, actual_ar)\n    \n            print(f\"\\n\uD83D\uDD4C Arabic Prompt: {prompt_ar}\")\n            print(f\"Expected: {expected_ar}\")\n            print(f\"Actual ({len(actual_ar)} chars): {actual_ar}\")\n            print(f\"\uD83D\uDD0D Similarity Score: {similarity_ar}\")\n    \n            # ✅ Attach Arabic results to Allure report\n            with allure.step(\"Attach Arabic response details\"):\n                allure.attach(prompt_ar, name=\"Arabic Prompt\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(expected_ar, name=\"Expected Arabic Response\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(actual_ar, name=\"Actual Arabic Response\", attachment_type=allure.attachment_type.TEXT)\n                allure.attach(str(round(similarity_ar, 3)), name=\"Arabic Similarity Score\", attachment_type=allure.attachment_type.TEXT)\n    \n                # Screenshot on low similarity\n                if similarity_ar < config.SIMILARITY_THRESHOLD_AR:\n                    try:\n                        allure.attach(driver.get_screenshot_as_png(), name=\"Arabic Screenshot\", attachment_type=allure.attachment_type.PNG)\n                    except Exception:\n                        pass\n    \n            # ✅ Semantic validation\n>           assert similarity_ar >= config.SIMILARITY_THRESHOLD_AR, (\n                f\"❌ Similarity too low ({similarity_ar:.3f}) for Arabic prompt: {prompt_ar}\"\n            )\nE           AssertionError: ❌ Similarity too low (0.260) for Arabic prompt: اختبر الاتجاه\nE           assert 0.26 >= 0.33\nE            +  where 0.33 = config.SIMILARITY_THRESHOLD_AR\n\ntests/test_chat_validation.py:304: AssertionError","steps":[{"name":"Attach Arabic response details","time":{"start":1761913351859,"stop":1761913352041,"duration":182},"status":"passed","steps":[],"attachments":[{"uid":"5670fbe9727e622d","name":"Arabic Prompt","source":"5670fbe9727e622d.txt","type":"text/plain","size":25},{"uid":"55904c459b57dc6a","name":"Expected Arabic Response","source":"55904c459b57dc6a.txt","type":"text/plain","size":121},{"uid":"35a3f5b3357b711b","name":"Actual Arabic Response","source":"35a3f5b3357b711b.txt","type":"text/plain","size":387},{"uid":"e42c223de94af2a6","name":"Arabic Similarity Score","source":"e42c223de94af2a6.txt","type":"text/plain","size":4},{"uid":"6071d72a598c2e93","name":"Arabic Screenshot","source":"6071d72a598c2e93.png","type":"image/png","size":171750}],"parameters":[],"stepsCount":0,"hasContent":true,"attachmentStep":false,"shouldDisplayMessage":false,"attachmentsCount":5}],"attachments":[{"uid":"66cf244bc0358a1d","name":"log","source":"66cf244bc0358a1d.txt","type":"text/plain","size":227},{"uid":"6433ddbe4f6da30d","name":"stdout","source":"6433ddbe4f6da30d.txt","type":"text/plain","size":2797}],"parameters":[],"stepsCount":1,"hasContent":true,"attachmentStep":false,"shouldDisplayMessage":true,"attachmentsCount":7},"afterStages":[{"name":"driver::0","time":{"start":1761913619561,"stop":1761913619711,"duration":150},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"hasContent":false,"attachmentStep":false,"shouldDisplayMessage":false,"attachmentsCount":0}],"labels":[{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_chat_validation"},{"name":"host","value":"Hemanth.local"},{"name":"thread","value":"25458-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_chat_validation"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"driver","value":"'desktop'"},{"name":"testdata","value":"{'prompt_ar': 'اختبر الاتجاه', 'expected_ar': 'واجهة المستخدم باللغة العربية يجب أن تكون من اليمين إلى اليسار (RTL).'}"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[]}],"tags":[]},"source":"9e4793bf08eee2e4.json","parameterValues":["'desktop'","{'prompt_ar': 'اختبر الاتجاه', 'expected_ar': 'واجهة المستخدم باللغة العربية يجب أن تكون من اليمين إلى اليسار (RTL).'}"]}